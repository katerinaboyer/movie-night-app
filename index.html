<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Night</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as inline SVG components
    const Film = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
        <line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/>
        <line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/>
        <line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/>
        <line x1="17" y1="7" x2="22" y2="7"/>
      </svg>
    );

    const Plus = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );

    const Edit2 = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
      </svg>
    );

    const Trash2 = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        <line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
      </svg>
    );

    const ThumbsUp = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/>
      </svg>
    );

    const ThumbsDown = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/>
      </svg>
    );

    const Sparkles = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
        <path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
      </svg>
    );

    const ChevronLeft = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    );

    const Calendar = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
    );

    const Bell = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    );

    const X = ({className}) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const MovieNightApp = () => {
      const [view, setView] = useState('home');
      const [currentUser, setCurrentUser] = useState('');
      const [movieNights, setMovieNights] = useState([]);
      const [themes, setThemes] = useState([
        'Time Travel', 'Heist', 'Sports', 'Musicals', 'Sci-Fi', 
        'Horror', 'Rom-Com', 'Based on a Book', 'Foreign Language', 
        'Documentaries', 'Animated', 'Film Noir'
      ]);
      const [selectedNight, setSelectedNight] = useState(null);
      const [newTheme, setNewTheme] = useState('');
      const [spinning, setSpinning] = useState(false);
      const [editingMovie, setEditingMovie] = useState(null);
      const [editingTheme, setEditingTheme] = useState(null);
      const [editingDate, setEditingDate] = useState(false);
      const [showReminders, setShowReminders] = useState(false);
      const [phoneNumber, setPhoneNumber] = useState('');
      const [reminders, setReminders] = useState([]);

      useEffect(() => {
        loadData();
      }, []);

      const loadData = () => {
        try {
          const nightsData = localStorage.getItem('movie-nights');
          if (nightsData) setMovieNights(JSON.parse(nightsData));
          
          const themesData = localStorage.getItem('themes');
          if (themesData) setThemes(JSON.parse(themesData));
          
          const userData = localStorage.getItem('current-user');
          if (userData) setCurrentUser(userData);

          const remindersData = localStorage.getItem('reminders');
          if (remindersData) setReminders(JSON.parse(remindersData));
        } catch (e) {
          console.log('No saved data found');
        }
      };

      const saveData = () => {
        try {
          localStorage.setItem('movie-nights', JSON.stringify(movieNights));
          localStorage.setItem('themes', JSON.stringify(themes));
          if (currentUser) localStorage.setItem('current-user', currentUser);
          localStorage.setItem('reminders', JSON.stringify(reminders));
        } catch (e) {
          console.error('Error saving data:', e);
        }
      };

      useEffect(() => {
        if (movieNights.length > 0 || themes.length > 0 || reminders.length > 0) {
          saveData();
        }
      }, [movieNights, themes, currentUser, reminders]);

      const createMovieNight = (theme) => {
        const newNight = {
          id: Date.now(),
          theme,
          date: new Date().toLocaleDateString(),
          submissions: [],
          eliminated: [],
          winner: null,
          reviews: []
        };
        setMovieNights([newNight, ...movieNights]);
        setSelectedNight(newNight);
        setView('submissions');
      };

      const updateNightDate = (nightId, newDate) => {
        const updated = movieNights.map(night =>
          night.id === nightId ? { ...night, date: newDate } : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === nightId));
        setEditingDate(false);
      };

      const deleteTheme = (theme) => {
        setThemes(themes.filter(t => t !== theme));
      };

      const updateTheme = (oldTheme, newTheme) => {
        setThemes(themes.map(t => t === oldTheme ? newTheme : t));
        setEditingTheme(null);
      };

      const addReminder = () => {
        if (!phoneNumber) return;
        const newReminder = {
          id: Date.now(),
          userId: currentUser,
          phone: phoneNumber
        };
        setReminders([...reminders, newReminder]);
        setPhoneNumber('');
        setShowReminders(false);
      };

      const removeReminder = (id) => {
        setReminders(reminders.filter(r => r.id !== id));
      };

      const addMovie = (title) => {
        const userSubmission = selectedNight.submissions.find(s => s.userId === currentUser);
        if (userSubmission) return;

        const newSubmission = {
          id: Date.now(),
          title,
          userId: currentUser,
          votes: 0,
          voters: []
        };

        const updated = movieNights.map(night =>
          night.id === selectedNight.id
            ? { ...night, submissions: [...night.submissions, newSubmission] }
            : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === selectedNight.id));
      };

      const updateMovie = (movieId, newTitle) => {
        const updated = movieNights.map(night =>
          night.id === selectedNight.id
            ? {
                ...night,
                submissions: night.submissions.map(s =>
                  s.id === movieId ? { ...s, title: newTitle } : s
                )
              }
            : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === selectedNight.id));
        setEditingMovie(null);
      };

      const deleteMovie = (movieId) => {
        const updated = movieNights.map(night =>
          night.id === selectedNight.id
            ? {
                ...night,
                submissions: night.submissions.filter(s => s.id !== movieId)
              }
            : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === selectedNight.id));
      };

      const voteMovie = (movieId, isUpvote) => {
        const updated = movieNights.map(night =>
          night.id === selectedNight.id
            ? {
                ...night,
                submissions: night.submissions.map(s => {
                  if (s.id !== movieId) return s;
                  const hasVoted = s.voters.includes(currentUser);
                  const voters = hasVoted
                    ? s.voters.filter(v => v !== currentUser)
                    : [...s.voters, currentUser];
                  const voteDelta = hasVoted ? -1 : (isUpvote ? 1 : -1);
                  return { ...s, votes: s.votes + voteDelta, voters };
                })
              }
            : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === selectedNight.id));
      };

      const spinWheel = () => {
        const active = selectedNight.submissions.filter(
          s => !selectedNight.eliminated.includes(s.id)
        );
        if (active.length <= 1) {
          if (active.length === 1) {
            const updated = movieNights.map(night =>
              night.id === selectedNight.id
                ? { ...night, winner: active[0].id }
                : night
            );
            setMovieNights(updated);
            setSelectedNight(updated.find(n => n.id === selectedNight.id));
          }
          return;
        }

        setSpinning(true);
        setTimeout(() => {
          const eliminated = active[Math.floor(Math.random() * active.length)];
          const updated = movieNights.map(night =>
            night.id === selectedNight.id
              ? { ...night, eliminated: [...night.eliminated, eliminated.id] }
              : night
          );
          setMovieNights(updated);
          setSelectedNight(updated.find(n => n.id === selectedNight.id));
          setSpinning(false);
        }, 2000);
      };

      const addReview = (rating, comment) => {
        const newReview = {
          id: Date.now(),
          userId: currentUser,
          rating,
          comment,
          date: new Date().toLocaleDateString()
        };
        const updated = movieNights.map(night =>
          night.id === selectedNight.id
            ? { ...night, reviews: [...night.reviews, newReview] }
            : night
        );
        setMovieNights(updated);
        setSelectedNight(updated.find(n => n.id === selectedNight.id));
      };

      if (!currentUser) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4">
            <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full shadow-2xl">
              <Film className="w-16 h-16 text-yellow-400 mx-auto mb-4" />
              <h1 className="text-3xl font-bold text-white text-center mb-2">Movie Night</h1>
              <p className="text-gray-300 text-center mb-6">Enter your name to continue</p>
              <input
                type="text"
                placeholder="Your name"
                className="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-400 border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                onKeyPress={(e) => e.key === 'Enter' && e.target.value && setCurrentUser(e.target.value)}
              />
            </div>
          </div>
        );
      }

      if (view === 'home') {
        const upcomingNight = movieNights.find(n => !n.winner);
        const pastNights = movieNights.filter(n => n.winner);
        const userReminder = reminders.find(r => r.userId === currentUser);

        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-4">
            <div className="max-w-2xl mx-auto">
              <div className="text-center mb-8 pt-8">
                <Film className="w-16 h-16 text-yellow-400 mx-auto mb-4" />
                <h1 className="text-4xl font-bold text-white mb-2">Movie Night</h1>
                <p className="text-gray-300">Welcome, {currentUser}!</p>
              </div>

              {upcomingNight ? (
                <div className="bg-gradient-to-br from-yellow-400/30 to-orange-500/30 backdrop-blur-lg rounded-3xl p-6 mb-6 shadow-xl border-2 border-yellow-400/50">
                  <div className="flex items-center justify-between mb-3">
                    <div className="flex items-center gap-2">
                      <Sparkles className="w-6 h-6 text-yellow-400" />
                      <h2 className="text-2xl font-bold text-white">This Week's Movie Night</h2>
                    </div>
                    <button
                      onClick={() => setShowReminders(!showReminders)}
                      className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-all"
                    >
                      <Bell className={`w-5 h-5 ${userReminder ? 'text-yellow-400' : 'text-white'}`} />
                    </button>
                  </div>

                  {showReminders && (
                    <div className="mb-4 p-4 bg-white/20 rounded-xl">
                      {userReminder ? (
                        <div className="flex items-center justify-between text-white">
                          <div>
                            <div className="font-semibold">Text Reminders Active</div>
                            <div className="text-sm text-gray-300">{userReminder.phone}</div>
                            <div className="text-xs text-gray-400 mt-1">
                              Note: This is a demo - actual texts won't be sent
                            </div>
                          </div>
                          <button
                            onClick={() => removeReminder(userReminder.id)}
                            className="p-2 bg-red-500/50 hover:bg-red-500/70 rounded-lg"
                          >
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div>
                          <p className="text-white text-sm mb-3">Get reminded to submit your movie</p>
                          <div className="flex gap-2">
                            <input
                              type="tel"
                              placeholder="Phone number"
                              value={phoneNumber}
                              onChange={(e) => setPhoneNumber(e.target.value)}
                              className="flex-1 px-3 py-2 rounded-lg bg-white/20 text-white placeholder-gray-300 border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                            />
                            <button
                              onClick={addReminder}
                              className="px-4 py-2 bg-yellow-400 hover:bg-yellow-500 rounded-lg font-semibold transition-all"
                            >
                              Sign Up
                            </button>
                          </div>
                          <p className="text-xs text-gray-300 mt-2">
                            Note: This is a demo - actual texts won't be sent
                          </p>
                        </div>
                      )}
                    </div>
                  )}

                  <button
                    onClick={() => {
                      setSelectedNight(upcomingNight);
                      setView('submissions');
                    }}
                    className="w-full text-left"
                  >
                    <div className="font-bold text-3xl text-white mb-2">{upcomingNight.theme}</div>
                    <div className="flex items-center gap-2 mb-3">
                      {editingDate ? (
                        <input
                          type="text"
                          defaultValue={upcomingNight.date}
                          className="px-3 py-1 rounded-lg bg-white/20 text-white border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              updateNightDate(upcomingNight.id, e.target.value);
                            }
                          }}
                          onBlur={(e) => updateNightDate(upcomingNight.id, e.target.value)}
                          autoFocus
                          onClick={(e) => e.stopPropagation()}
                        />
                      ) : (
                        <>
                          <Calendar className="w-4 h-4 text-gray-200" />
                          <span className="text-gray-200">{upcomingNight.date}</span>
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              setEditingDate(true);
                            }}
                            className="p-1 hover:bg-white/20 rounded"
                          >
                            <Edit2 className="w-3 h-3 text-gray-200" />
                          </button>
                        </>
                      )}
                    </div>
                    <div className="flex gap-4 text-sm">
                      <span className="text-yellow-400 font-semibold">
                        {upcomingNight.submissions.length} submissions
                      </span>
                      <span className="text-gray-300">
                        {upcomingNight.eliminated.length} eliminated
                      </span>
                    </div>
                  </button>
                </div>
              ) : (
                <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-6 mb-6 shadow-xl">
                  <h2 className="text-2xl font-bold text-white mb-4">Start New Movie Night</h2>
                  <div className="space-y-3">
                    {themes.map(theme => (
                      <div key={theme} className="flex items-center gap-2">
                        {editingTheme === theme ? (
                          <>
                            <input
                              type="text"
                              defaultValue={theme}
                              className="flex-1 px-4 py-3 rounded-xl bg-white/20 text-white border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                  updateTheme(theme, e.target.value);
                                }
                              }}
                              autoFocus
                            />
                            <button
                              onClick={() => setEditingTheme(null)}
                              className="px-4 py-3 bg-white/20 rounded-xl text-white"
                            >
                              Cancel
                            </button>
                          </>
                        ) : (
                          <>
                            <button
                              onClick={() => createMovieNight(theme)}
                              className="flex-1 px-6 py-4 bg-white/20 hover:bg-white/30 rounded-xl text-white font-semibold transition-all text-left border border-white/20"
                            >
                              {theme}
                            </button>
                            <button
                              onClick={() => setEditingTheme(theme)}
                              className="p-4 bg-white/20 hover:bg-white/30 rounded-xl transition-all"
                            >
                              <Edit2 className="w-4 h-4 text-white" />
                            </button>
                            <button
                              onClick={() => deleteTheme(theme)}
                              className="p-4 bg-red-500/50 hover:bg-red-500/70 rounded-xl transition-all"
                            >
                              <Trash2 className="w-4 h-4 text-white" />
                            </button>
                          </>
                        )}
                      </div>
                    ))}
                  </div>
                  <div className="mt-4 flex gap-2">
                    <input
                      type="text"
                      placeholder="Add custom theme"
                      value={newTheme}
                      onChange={(e) => setNewTheme(e.target.value)}
                      className="flex-1 px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-400 border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                    />
                    <button
                      onClick={() => {
                        if (newTheme) {
                          setThemes([...themes, newTheme]);
                          setNewTheme('');
                        }
                      }}
                      className="px-6 py-3 bg-yellow-400 hover:bg-yellow-500 rounded-xl font-semibold transition-all"
                    >
                      <Plus className="w-5 h-5" />
                    </button>
                  </div>
                </div>
              )}

              {pastNights.length > 0 && (
                <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-6 shadow-xl">
                  <h2 className="text-2xl font-bold text-white mb-4">Past Movie Nights</h2>
                  <div className="space-y-3">
                    {pastNights.map(night => (
                      <button
                        key={night.id}
                        onClick={() => {
                          setSelectedNight(night);
                          setView('reviews');
                        }}
                        className="w-full px-6 py-4 bg-white/20 hover:bg-white/30 rounded-xl text-white transition-all text-left border border-white/20"
                      >
                        <div className="font-semibold text-lg">{night.theme}</div>
                        <div className="text-sm text-gray-300">{night.date}</div>
                        <div className="text-sm text-yellow-400 mt-1">
                          ðŸ† {night.submissions.find(s => s.id === night.winner)?.title}
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      if (view === 'submissions') {
        const userSubmission = selectedNight.submissions.find(s => s.userId === currentUser);
        const activeMovies = selectedNight.submissions.filter(
          s => !selectedNight.eliminated.includes(s.id)
        );
        const canSpin = activeMovies.length > 1;

        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-4">
            <div className="max-w-2xl mx-auto">
              <button
                onClick={() => setView('home')}
                className="flex items-center gap-2 text-white mb-4 hover:text-yellow-400 transition-colors"
              >
                <ChevronLeft className="w-5 h-5" />
                Back
              </button>

              <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-6 mb-6 shadow-xl">
                <h2 className="text-3xl font-bold text-white mb-2">{selectedNight.theme}</h2>
                <div className="flex items-center gap-2">
                  {editingDate ? (
                    <input
                      type="text"
                      defaultValue={selectedNight.date}
                      className="px-3 py-2 rounded-lg bg-white/20 text-white border border-white/30 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                      onKeyPress={(e) => {
                        if (e.key === 'Enter') {
                          updateNightDate(selectedNight.id, e.target.value);
                        }
                      }}
                      onBlur={(e) => updateNightDate(selectedNight.id, e.target.value)}
                      autoFocus
                    />
                  ) : (
                    <>
                      <Calendar className="w-4 h-4 text-gray-300" />
                      <span className="text-gray-300">{selectedNight.date}</span>
                      <button
                        onClick={() => setEditingDate(true)}
                        className="p-1 hover:bg-white/20 rounded"
                      >
                        <Edit2 className="w-3 h-3 text-gray-300" />
                      </button>
                    </>
                  )}
                </div>
              </div>

              {!userSubmission && !selectedNight.winner && (
                <div className="bg-white/10 backdrop-blur-lg rounded-3
